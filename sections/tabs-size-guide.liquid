{%- comment -%}
  Block types: category, table
  - "category" starts an accordion group (e.g. Mens, Womens, Kids)
  - "table" renders a tab with a data table
    - If is_sub_table is checked, it renders within the current tab instead of creating a new one
  Rows are entered as plain text in a textarea: one row per line, values separated by commas.
{%- endcomment -%}

<div class="tabs-size-guid">
  <div class="page-width" style="max-width:1400px;margin:auto;padding:0 15px;">

    {%- comment -%}--- NAVIGATION SIDEBAR ---{%- endcomment -%}
    <div class="block-tabs">
      {%- assign cat_num = 0 -%}
      {%- assign tab_total = 0 -%}
      {%- assign nav_open = false -%}
      {%- for block in section.blocks -%}
        {%- if block.type == 'category' -%}
          {%- if nav_open -%}</ul></div>{%- endif -%}
          {%- assign cat_num = cat_num | plus: 1 -%}
          <div class="block-tab" {{ block.shopify_attributes }}>
            <h3 {% if cat_num == 1 %}class="active"{% endif %}>{{ block.settings.heading }}</h3>
            <ul {% if cat_num == 1 %}style="display:block;"{% endif %}>
          {%- assign nav_open = true -%}
        {%- elsif block.type == 'table' and block.settings.is_sub_table != true -%}
          {%- assign tab_total = tab_total | plus: 1 -%}
          <li {% if tab_total == 1 %}class="active"{% endif %}>
            <a href="#tab-{{ block.id }}">{{ block.settings.tab_name }}</a>
          </li>
        {%- endif -%}
      {%- endfor -%}
      {%- if nav_open -%}</ul></div>{%- endif -%}
    </div>

    {%- comment -%}--- CONTENT PANELS ---{%- endcomment -%}
    <div id="tabs-content">
      {%- assign tab_count = 0 -%}
      {%- assign panel_open = false -%}
      {%- assign current_cat_image_url = '' -%}

      {%- for block in section.blocks -%}

        {%- if block.type == 'category' -%}
          {%- if panel_open -%}
            <br>
            <h2>Measuring advice</h2>
            <p>Take your actual body measurements as they are more accurate than measuring over your clothes.</p>
            {%- if current_cat_image_url != blank -%}
              <img src="{{ current_cat_image_url }}" alt="Measuring chart" loading="lazy" style="max-width:100%;">
            {%- endif -%}
            </div>
            {%- assign panel_open = false -%}
          {%- endif -%}
          {%- assign current_cat_image_url = block.settings.measuring_image_url -%}

        {%- elsif block.type == 'table' -%}

          {%- unless block.settings.is_sub_table -%}
            {%- if panel_open -%}
              <br>
              <h2>Measuring advice</h2>
              <p>Take your actual body measurements as they are more accurate than measuring over your clothes.</p>
              {%- if current_cat_image_url != blank -%}
                <img src="{{ current_cat_image_url }}" alt="Measuring chart" loading="lazy" style="max-width:100%;">
              {%- endif -%}
              </div>
            {%- endif -%}
            {%- assign tab_count = tab_count | plus: 1 -%}
            <div id="tab-{{ block.id }}" class="tab-content" {% if tab_count == 1 %}style="display:block;"{% endif %} {{ block.shopify_attributes }}>
            {%- assign panel_open = true -%}
          {%- endunless -%}

          {%- if block.settings.heading != blank -%}
            <h4 style="margin-top:20px;">{{ block.settings.heading }}</h4>
          {%- endif -%}

          {%- assign cols = block.settings.columns | split: ',' -%}
          <div style="overflow-x:auto;max-width:100%;">
            <table>
              <thead>
                <tr>
                  {%- for col in cols -%}
                    <th>{{ col | strip }}</th>
                  {%- endfor -%}
                </tr>
              </thead>
              <tbody>
                {%- assign rows_raw = block.settings.rows_data | strip -%}
                {%- if rows_raw != '' -%}
                  {%- assign rows_lines = rows_raw | newline_to_br | split: '<br />' -%}
                  {%- for line in rows_lines -%}
                    {%- assign line_clean = line | strip -%}
                    {%- if line_clean != '' -%}
                      {%- assign cells = line_clean | split: ',' -%}
                      <tr>
                        {%- for cell in cells -%}
                          <td>{{ cell | strip }}</td>
                        {%- endfor -%}
                      </tr>
                    {%- endif -%}
                  {%- endfor -%}
                {%- endif -%}
              </tbody>
            </table>
          </div>

          {%- if block.settings.note != blank -%}
            <p style="font-size:12px;font-style:italic;margin-top:5px;">{{ block.settings.note }}</p>
          {%- endif -%}

        {%- endif -%}
      {%- endfor -%}

      {%- if panel_open -%}
        <br>
        <h2>Measuring advice</h2>
        <p>Take your actual body measurements as they are more accurate than measuring over your clothes.</p>
        {%- if current_cat_image_url != blank -%}
          <img src="{{ current_cat_image_url }}" alt="Measuring chart" loading="lazy" style="max-width:100%;">
        {%- endif -%}
        </div>
      {%- endif -%}
    </div>

  </div>
</div>

<style>
  .tabs-size-guid{padding:50px 0}
  .tabs-size-guid ul{list-style:none;padding-left:0;}
  .tabs-size-guid #tabs-content{padding:0;}
  .tabs-size-guid .block-tabs{margin-bottom:30px;}
  @media only screen and (min-width:800px){
    body .tabs-size-guid .block-tabs{width:30%;border-top:2px solid}
    body .tabs-size-guid .page-width{display:flex;}
    body .tabs-size-guid #tabs-content{max-width:70%;padding-left:30px;}
  }
  @media only screen and (max-width:800px){
    body .tabs-size-guid .block-tab{padding-bottom:10px;}
    .tabs-size-guid .tab-content{overflow-x:auto;}
  }
  .tabs-size-guid .tab-content img{max-width:100%}
  .tabs-size-guid .block-tab{border-bottom:1px solid;padding-left:30px;padding-right:10px;padding-top:15px;}
  .tabs-size-guid .block-tabs h3{margin-top:0;font-size:18px;position:relative;cursor:pointer;}
  .tabs-size-guid .block-tabs h3:before{
    width:0;content:'';height:0;position:absolute;left:-20px;top:9px;
    border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid #000;
  }
  .tabs-size-guid .block-tab ul{display:none;}
  .tabs-size-guid .tab-content{display:none;}
  .tabs-size-guid .block-tab ul li a{cursor:pointer;text-decoration:none;color:#000;}
  .tabs-size-guid .block-tab ul li.active a{font-weight:bold;}
  .tabs-size-guid .block-tabs h3.active:before{transform:rotate(-90deg);}
  .tabs-size-guid table{
    border-spacing:0;border-collapse:collapse;width:100%;border:1px solid #c7c7c7;
    font-family:Arial,sans-serif;text-align:center;
  }
  .tabs-size-guid table th{
    background-color:#f5f5f5;padding:10px;border:1px solid #ddd;font-size:14px;
  }
  .tabs-size-guid table td{
    padding:10px;border:1px solid #ddd;text-align:center;min-width:3em;
  }
  .tabs-size-guid table td:first-child,
  .tabs-size-guid table th:first-child{
    font-weight:bold;text-align:left;white-space:nowrap;
  }
  .tabs-size-guid table tbody tr:nth-child(even){background-color:#f9f9f9;}
  .tabs-size-guid table td:empty,
  .tabs-size-guid table th:empty{display:table-cell;}
</style>

<script>
  $(".tabs-size-guid .block-tabs h3").click(function(){
    $(this).next().slideToggle(150);
    $(this).toggleClass('active');
  });
  $('.tabs-size-guid li').click(function(){
    $('.tabs-size-guid li').removeClass('active');
    $(this).addClass('active');
    $('.tabs-size-guid .tab-content').hide();
    var activeTab = $(this).find('a').attr('href');
    $(activeTab).fadeIn();
    return false;
  });
</script>

{% schema %}
{
  "name": "Size Guide Tabs",
  "max_blocks": 50,
  "settings": [],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Category name",
          "default": "Mens",
          "info": "Accordion heading (e.g. Mens, Womens, Kids)"
        },
        {
          "type": "text",
          "id": "measuring_image_url",
          "label": "Measuring chart image URL",
          "info": "Full URL to the measuring advice image"
        }
      ]
    },
    {
      "type": "table",
      "name": "Table / Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_name",
          "label": "Tab name",
          "default": "Tops",
          "info": "Shown in the sidebar navigation"
        },
        {
          "type": "checkbox",
          "id": "is_sub_table",
          "label": "Sub-table (same tab)",
          "default": false,
          "info": "Check to add this table within the current tab instead of creating a new one"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Table heading",
          "info": "Optional heading above the table"
        },
        {
          "type": "text",
          "id": "columns",
          "label": "Column headers",
          "default": "Size, XS, S, M, L, XL",
          "info": "Comma-separated column headers"
        },
        {
          "type": "textarea",
          "id": "rows_data",
          "label": "Table rows",
          "default": "Chest (To Fit), 32-34, 35-37, 38-40, 41-43, 44-46",
          "info": "One row per line. Values separated by commas. First value is the row label."
        },
        {
          "type": "text",
          "id": "note",
          "label": "Note below table",
          "info": "Optional note shown after the table (e.g. Measurements in inches)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Size Guide Tabs"
    }
  ]
}
{% endschema %}
